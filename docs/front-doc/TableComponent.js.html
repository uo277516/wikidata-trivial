<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: TableComponent.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: TableComponent.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect } from 'react';
import { Table, Switch, Segmented, Space, notification } from 'antd';
import moment from 'moment';
import axios from 'axios'; 
import { useTranslation } from 'react-i18next';
import '../styles/styles.css'; 


/**
 * TableComponent. Displays a table with streak data that can be filtered and sorted.
 *
 * @component
 * @param {Object} props - Component properties.
 * @param {Object} props.user - User information.
 * @returns {React.JSX.Element} Rendered component.
 */
const TableComponent = (props) => {
    let {user} = props;
    const [myClasification, setMyClasification] = useState(false);
    const [streaks, setStreaks] = useState([]);
    const [filteredStreaks, setFilteredStreaks] = useState([]);
    const [filteredOption, setFilteredOption] = useState(0); 
    const { t } = useTranslation();
    
    /**
    * Lifecycle hook for fetching streaks on component mount.
    * @function useEffect
    * @returns {void}
    */
    useEffect(() => {
        fetchStreaks();
    }, []);

    /**
    * Lifecycle hook for filtering streaks when streaks, my clasification of filtered option change.
    * @function useEffect
    * @returns {void}
    */
    useEffect(() => {
        filterStreaks();
    }, [streaks, myClasification, filteredOption]);

    /**
     * Fetches streak data from the backend.
     * @function fetchStreaks
     * @async
     * @returns {Promise&lt;Void>}
     */
    const fetchStreaks = async () => {
        try {
            const response = await axios.get('http://localhost:3001/getAllStreaks');
            setStreaks(response.data);
        } catch (error) {
            notification.error({message: t('table.error'), description: t('table.errorDesc'), placement: 'top'});
            console.error('Error fetching streaks:', error);
        }
    };

    /**
     * Filters streak data based on user classification and selected filter option.
     * @function filterStreaks
     * @returns {void}
     */
    const filterStreaks = () => {
        let filteredData = [...streaks];

        //filter by user classification if enabled
        if (myClasification) {
            const currentUser = user._json.username; 
            filteredData = filteredData.filter(item => item.username === currentUser);
        }

        //apply filter from segmented control
        switch (filteredOption) {
            case 0: //today
                filteredData = filteredData.filter(item => moment(item.date).isSame(moment(), 'day'));
                break;
            case 1: //last week
                filteredData = filteredData.filter(item => moment(item.date).isSame(moment(), 'week'));
                break;
            case 2: //this month
                filteredData = filteredData.filter(item => moment(item.date).isSame(moment(), 'month'));
                break;
            default: //all
                break;
        }

        setFilteredStreaks(filteredData);
    };

    /**
     * Handles changes in the segmented control.
     * @function handleSegmentedChange
     * @param {number} value - The selected filter option.
     * @returns {void}
     */
    const handleSegmentedChange = (value) => {
        setFilteredOption(value);
    };


    //columns of the table
    let columns = [
        {
            title: t('table.username'),
            dataIndex: 'username',
            key: 'username'
        },
        {
            title: t('table.questions'),
            dataIndex: 'racha',
            key: 'racha',
            sorter: (a, b) => a.racha - b.racha
        },
        {
            title: t('table.category'),
            dataIndex: 'categoria',
            key: 'categoria',
            filters: [
                {
                    text: t('table.deporte'),
                    value: t('table.deporte'),
                },
                {
                    text: t('table.música'),
                    value: t('table.música'),
                },
                {
                    text: t('table.investigación'),
                    value: t('table.investigación'),
                },
            ],
            onFilter: (value, record) => record.categoria.indexOf(value) === 0,
        },
        {
            title: t('table.date'),
            dataIndex: 'fecha',
            key: 'fecha',
            sorter: (a, b) => moment(a.fecha, 'DD/MM/YYYY').unix() - moment(b.fecha, 'DD/MM/YYYY').unix(),
        }
    ];

    //filter streaks to show only the data required and format data
    let dataStreaks = filteredStreaks.map(item => ({
        key: item.id,
        username: item.username,
        racha: item.streak,
        categoria: t(`table.${item.category}`),
        fecha: moment(item.date).format('DD/MM/YYYY')
    }));


    //add or remove columns is user classification is enabled or not
    if (myClasification) {
        columns = columns.slice(1);

        dataStreaks = filteredStreaks.map(item => ({
            key: item.id,
            racha: item.streak,
            categoria: t(`table.${item.category}`),
            fecha: moment(item.date).format('DD/MM/YYYY')
        }));
    }


    return (
        &lt;div>
            &lt;Space>
                &lt;Switch
                    checked={myClasification}
                    onChange={() => setMyClasification(!myClasification)}
                    checkedChildren={t('table.rakings')}
                    unCheckedChildren={t('table.myRanking')}
                    style={{ marginBottom: '1em', marginTop: '1em', width:'11em'}}
                />
                &lt;Segmented
                    value={filteredOption}
                    onChange={handleSegmentedChange}
                    options={[
                        {
                            label: t('table.today'),
                            value: 0,
                        },
                        {
                            label: t('table.week'),
                            value: 1,
                        },
                        {
                            label: t('table.month'),
                            value: 2,
                        },
                        {
                            label: t('table.all'),
                            value: 3,
                        },
                    ]}
                    style={{ marginLeft: '0.3em' }}
                />

            &lt;/Space>
            &lt;Table size='large' columns={columns} dataSource={dataStreaks} style={{ marginTop: '1em' }} />
        &lt;/div>
    );
};

export default TableComponent;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#CategorySelectionPage">CategorySelectionPage</a></li><li><a href="global.html#LoginComponent">LoginComponent</a></li><li><a href="global.html#MenuComponent">MenuComponent</a></li><li><a href="global.html#PrincipalScreen">PrincipalScreen</a></li><li><a href="global.html#QuestionCard">QuestionCard</a></li><li><a href="global.html#TableComponent">TableComponent</a></li><li><a href="global.html#asyncTestFunction">asyncTestFunction</a></li><li><a href="global.html#cancel">cancel</a></li><li><a href="global.html#changeLanguage">changeLanguage</a></li><li><a href="global.html#checkAuthentication">checkAuthentication</a></li><li><a href="global.html#checkStreak">checkStreak</a></li><li><a href="global.html#fetchQuestions">fetchQuestions</a></li><li><a href="global.html#fetchStreaks">fetchStreaks</a></li><li><a href="global.html#fetchUserData">fetchUserData</a></li><li><a href="global.html#filterStreaks">filterStreaks</a></li><li><a href="global.html#funcProperties">funcProperties</a></li><li><a href="global.html#handleCategoryChange">handleCategoryChange</a></li><li><a href="global.html#handleGiveUp">handleGiveUp</a></li><li><a href="global.html#handleLoadingState">handleLoadingState</a></li><li><a href="global.html#handleLogin">handleLogin</a></li><li><a href="global.html#handleRestart">handleRestart</a></li><li><a href="global.html#handleSegmentedChange">handleSegmentedChange</a></li><li><a href="global.html#handleSend">handleSend</a></li><li><a href="global.html#handleSendButton">handleSendButton</a></li><li><a href="global.html#handleSendSameEntityButton">handleSendSameEntityButton</a></li><li><a href="global.html#handleStartGame">handleStartGame</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#ok">ok</a></li><li><a href="global.html#openPop">openPop</a></li><li><a href="global.html#saveStreak">saveStreak</a></li><li><a href="global.html#setSelCategory">setSelCategory</a></li><li><a href="global.html#useEffect">useEffect</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Thu Jun 20 2024 23:08:59 GMT+0200 (hora de verano de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
